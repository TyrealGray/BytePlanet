<h2>module programming in UE4</h2>

<div class="diaryContext">
    <p>I tried to find the way about module programming in UE4,but many of them is discribing how to program a plugin in UE4.Then I tried to remember how my manager did about,lucky I found out it's only little different with plugin.Time to share my loot</p>
    <hr>
    <p>首先建立一個空的C++虛幻4項目，例如我的項目名字為<b>MainModule</b>。此時，進入工程路徑，在<b>MainModule\Source\</b>下建立一個<b>TestModule</b>文件夾。</p>
    <figure class="tmblr-full"><img src="http://65.media.tumblr.com/0f7fb65dc46f48a15500776af9aeeb92/tumblr_inline_np63cpyvd51tuwv4e_500.png" alt="image"></figure>
    <p>然後在<b>TestModule</b>文件夾中建立<b>Public</b>和<b>Private</b>文件夾，以及<b>TestModule.Build.cs</b></p>
    <figure class="tmblr-full"><img src="http://66.media.tumblr.com/169f3a8ce3004851fd535a88386c6147/tumblr_inline_np688kC80b1tuwv4e_500.png" alt="image"></figure>
    <p>然後，在<b>Public</b>文件夾中，生成<b>TestModule.h</b>，內容如下：</p>
    <ol>
        <li><b>#pragma once<br></b></li>
        <li><b>#include “ModuleManager.h”<br></b></li>
        <li><b>class TestModuleImpl : public IModuleInterface<br></b></li>
        <li><b>{<br></b></li>
        <li><b>public:<br></b></li>
        <li><b>&nbsp; &nbsp;/** IModuleInterface implementation */<br></b></li>
        <li><b>&nbsp; &nbsp;void StartupModule();<br></b></li>
        <li><b>&nbsp; &nbsp;void ShutdownModule();</b></li>
        <li><b>};</b></li>
    </ol>
    <hr>
    <p>然後在<b>Private</b>文件中生成<b>TestModule.cpp</b>，內容如下：</p>
    <ol>
        <li><b>#include “TestModule.h”<br></b></li>
        <li><b>void TestModuleImpl::StartupModule()<br></b></li>
        <li><b>{<br></b></li>
        <li><b>}<br></b></li>
        <li><b>void TestModuleImpl::ShutdownModule()<br></b></li>
        <li><b>{<br></b></li>
        <li><b>}<br></b></li>
        <li><b>IMPLEMENT_GAME_MODULE(TestModuleImpl, 

<b>TestModule</b>)</b><br></li>
    </ol>
    <hr>
    <p>

        然後在<b>Private</b>文件中生成<b>TestModulePrivatePCH.h</b>，它可以引用一些通用的虛幻4公共頭文件,例如：

        <br></p>
    <ol>
        <li><b>#pragma once</b><br></li>
        <li><b>#include “Engine.h”</b><br></li>
    </ol>
    <hr>
    <p>

        然後在<b>TestModule.Build.cs</b>中寫入如下：</p>
    <ol>
        <li><b>using UnrealBuildTool;<br></b></li>
        <li><b>public class TestModule : ModuleRules<br></b></li>
        <li><b>{<br></b></li>
        <li><b>&nbsp; &nbsp;public TestModule(TargetInfo Target)<br></b></li>
        <li><b>{<br></b></li>
        <li><b>PublicDependencyModuleNames.AddRange(new string[] { “Core”, “CoreUObject”, “Engine”, “InputCore” });<br></b></li>
        <li><b><br></b></li>
        <li><b>PrivateIncludePaths.AddRange(new string[] { “TestModule/Private” });<br></b></li>
        <li><b>&nbsp; &nbsp; &nbsp; &nbsp;PublicIncludePaths.AddRange(new string[] { “TestModule/Public” });<br></b></li>
        <li><b>}<br></b></li>
        <li><b>}</b><br></li>
    </ol>
    <hr>
    <p>完成上述編碼後，在<b>MainModule.Target.cs</b>和<b>MainModuleEditor.Target.cs</b>中都將</p>
    <ol>
        <li><b>OutExtraModuleNames.AddRange( new string[] { “MainModule” } );</b><br></li>
    </ol>
    <p>改為</p>
    <ol>
        <li><b>OutExtraModuleNames.AddRange( new string[] { “MainModule”,“TestModule” } );</b><br></li>
    </ol>
    <p>然後在虛幻4工程文件<b>MainModule.uproject</b>中的<b>“Module”</b>關鍵值中加入一組：</p>
    <ol>
        <li><b>“Modules”: [</b><br></li>
        <li><b>{</b><br></li>
        <li><b>“Name”: “MainModule”,</b><br></li>
        <li><b>“Type”: “Runtime”,</b><br></li>
        <li><b>“LoadingPhase”: “Default”,</b><br></li>
        <li><b>“AdditionalDependencies”: [</b><br></li>
        <li><b>“Engine”</b><br></li>
        <li><b>]</b><br></li>
        <li><b>},</b><br></li>
        <li><b>{</b><br></li>
        <li><b>“Name”: “TestModule”,</b><br></li>
        <li><b>“Type”: “Runtime”,</b><br></li>
        <li><b>“LoadingPhase”: “PreDefault”</b></li>
        <li><b>}</b><br></li>
        <li><b>]</b><br></li>
    </ol>
    <p>最後，雙擊

        <b>MainModule.uproject</b>並且重新刷新<b>vs</b>項目代碼，我們就可以得到這樣的結構了</p>
    <figure class="tmblr-full"><img src="http://67.media.tumblr.com/eeb38940a9a0eaca3c26240055da7f49/tumblr_inline_np68z42jwv1tuwv4e_400.png" alt="image"></figure>
    <p>這個時候，在<b>editor</b>中，添加<b>C++</b>代碼時，也能夠看到</p>
    <figure class="tmblr-full"><img src="http://67.media.tumblr.com/f563ea854d3fd55a9160d58d65928169/tumblr_inline_np690mewyF1tuwv4e_500.png" alt="image"></figure>
    <p>另外<b>需要注意的就是</b>你在<b>TestModlue</b>下生成的類，例如<b>Actor</b>類，在<b>.h</b>頭文件中，需要記得應用

        <b>Engine.h</b>頭文件。</p>
    <hr>
    <p>至此，所有建立模塊化的步驟都大功告成了。在<b>TestModule</b>中寫好代碼之後，直接拷貝<b>TestModule</b>到其他項目，也可以直接使用了。是不是很方便呢？</p>
    <p><br></p>
    <p>最後，歡迎大家加入QQ群302281607加入到虛幻4開發技術的討論當中來。</p>
</div>